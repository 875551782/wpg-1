<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
	.order_num{
		width: 80px;
		height: 34px;
		text-align:center;
		border-radius:5%;
	}
</style>
<link
	href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"
	rel="stylesheet">
<link href="./css/both.css" rel="stylesheet">
<link href="./css/sfq.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery.js"></script>
<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
	<div class="header">威派格智慧水务</div>
	<div class="container">
		<div class="area"></div>
		<!-- 添加手风琴样式内容 -->
		<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
		</div>
	</div>
	<div class="foot">
		Copyright ©2019 <a href="#">威派格智慧水务</a>. All rights reserved.
	</div>
</body>
<script>
	init();
	function init() {
		$.ajax({
			type : "GET",
			url : "user_showWater_Division.do",
			success : function(data) {
				console.log(data);
				if(data.length>0){
					$(".area").html("<h3>"+data[0].region+"</h3>");
				}
				//data为当前大区的所有水司数据
				for (var i = 0; i <data.length; i++) {
					var str="<div class='panel panel-default'><div class='panel-heading' role='tab' id='heading"+i+"'><h4 class='panel-title'>";
					if(i==0){
						str+="<a role='button' data-toggle='collapse' data-parent='#accordion' href='#collapse"+i+"' aria-expanded='true' aria-controls='collapse"+i+"'>"+
						data[i].wName+"负责人："+data[i].pic.pName+"电话："+data[i].pic.pTel+"</a></h4></div><div id='collapse"+i+"' class='panel-collapse collapse in' role='tabpanel' aria-labelledby='heading"+i+"'><div class='panel-body'>"+
						"<table class='table table-bordered'><tr><th>订单编号</th><th>订单信息</th><th>订单数量</th><th>详细信息</th></tr></table></div></div></div>";
					}else{
						str+="<a  class='collapsed' role='button' data-toggle='collapse' data-parent='#accordion' href='#collapse"+i+"' aria-expanded='false' aria-controls='collapse"+i+"'>"+
						data[i].wName+"负责人："+data[i].pic.pName+"电话："+data[i].pic.pTel+"</a></h4></div><div id='collapse"+i+"' class='panel-collapse collapse' role='tabpanel' aria-labelledby='heading"+i+"'><div class='panel-body'>"+
						"<table class='table table-bordered'><tr><th>订单编号</th><th>订单信息</th><th>订单数量</th><th>详细信息</th></tr></table></div></div></div>";
					}
					$("#accordion").append(str);
					//该水司的订单对象
					var order=data[i].orderInfo;
					//遍历订单，往表格中添加具体数据
					for(var j=0;j<order.length;j++){
						//当前订单的物料信息
						var hardware=order[j].order_Hardwares;
						//记录所有物料名称及数量
						var hStr="";
						//记录物料的总价
						var sprice=0;
						for(var k=0;k<hardware.length;k++){
							sprice+=hardware[k].hardware_Group.hardwareList[0].price;
							hStr+=hardware[k].hardware_Group.hardwareList[0].name+"X"+hardware[k].hardware_Group.hardwareList[0].num+",";
						}
						$(".table").eq(i).append("<tr><td>"+j+"</td><td>"+hStr+"<span class=''>订单总价"+sprice+"</span></td><td><input class='order_num' type='number' onchange='changeNum("+data[i].wId+","+order[j].oId+",this)' value='"+order[j].num+"'></td><td><button class='btn btn-default' type='button'>查看详细信息</button></td></tr>");
					}
				}
			}
		});
	}
	
	function changeNum(wId,oId,obj){
		if(window.confirm("您确定要修改该订单数量吗")){
			$.ajx({
				type:"GET",
				url:"user_updateOrderNum.do",
				data:{wId:wId,oId:oId,num:$(obj).val()},
				success:function(data){
					if(data==1){
						alert("修改成功");
						init();
					}else{
						alert("修改失败");
					}
				}
			})
		}
		console.log(wId+","+oId);
		console.log($(obj).val());
		
	}
</script>
</html>