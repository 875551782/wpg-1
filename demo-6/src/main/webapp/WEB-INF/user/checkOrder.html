<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">

<title>Insert title here</title>
<link
	href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"
	rel="stylesheet">
<script src="https://code.jquery.com/jquery.js"></script>
<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<style type="text/css">
/*手风琴样式 */
a:hover, a:focus {
	text-decoration: none;
	outline: none;
}

/*整体样式  */
.con {
	display: flex;

}

.left {
	flex: 1;
}

.right {
	flex: 5;
}
/* order样式 */

.orderList{
	text-align:center;
	
	margin-right:50px;
	margin-left:50px;
}
.showDetail{
margin-left:50px;
	margin-right:50px;
}


#order th {
	text-align: center;
}

#order {
	text-align: center;
	display: none;
	
}
#tableOrder input{
	width:50px;
}
#total{
text-align:right;
color:red;
}

.td1{
width:500px;

}


.td2,.td3{
width:60px;
}
</style>
</head>
<body>
	<div class="con">
		<div class="left">
			<ul class="nav nav-pills nav-stacked">
				<li role="presentation"><a href="user_forward.do?name=index">生成订单</a></li>
				<li role="presentation" class="active"><a
					href="user_forward.do?name=checkOrder">查看订单</a></li>
			</ul>
		</div>
		<div class="right">
			<!-- 显示订单 -->
    		<div class="orderList">
    			<div class="panel panel-primary">
					<div class="panel-heading">订单列表</div>
  					<div class="panel-body">
						<table class="table table-hover" id="tableList"></table>
					</div>
				</div>
			</div>
			<!-- 显示详细订单 -->
			<div class="showDetail" id="order">
				<div class="panel panel-primary">
					<div class="panel-heading">订单详情</div>
  					<div class="panel-body" id="tab">
						<table class="table table-hover table-bordered" id="tableOrder">
							<tr>
								<th>功能名称</th>
								<th>物料名称</th>
								<th>规格型号</th>
								<th>单位</th>
								<th>数量</th>
								<th>品牌</th>
								<th>价格</th>
							</tr>
						</table>
					</div>
				</div>	
			</div>
  		</div>
	</div>
	<script type="text/javascript">
		getOrder();
		function getOrder() {
			$.ajax({
				type : "GET",

				url : "user_showOrder.do",

				success : function(data) {

					console.log(data);
					//拿到所有的订单编号
					for ( var key in data) {
						console.log(key);
					/* 	$(".orderList").append(
								"<a href='#order' class='list-group-item' onclick='showOrder("
										+ data[key].order_Id + ")'>"
										+ data[key].order_Id + "</a>"+
										"<a class='btn btn-default' href='#' role='button'>删除</a>"); */
						$("#tableList").append(
								"<tr><td class='td1'><a href='#order'  onclick='showOrder("
										+ data[key].order_Id + ")'>订单"+ data[key].order_Id + "</a></td>"+
										"<td class='td2'><a class='btn btn-default' href='javascript:del("+data[key].order_Id+")' role='button'>删除</a></td>"+
										"<td class='td3'><a class='btn btn-default' href='user_orderUpload.do?oId="+data[key].order_Id+"' role='button'>下载</a></td></tr>");
					}

					/* item(); */
				}
			})
		}
		//选订单时改变样式
		function item() {
			/* $(".list-group-item").each(function() {
				$(this).mouseover(function() {
					$(this).siblings().removeClass("active");
					$(this).addClass("active");
				
				});
			}) */
			
			$("#orderList td").hover(function(){
				$(this).parent().addClass("blue");
			})
		}

		function showOrder(id) {
			$.ajax({
				url : "user_showDetailOrder.do",
				data : {
					"oId" : id
				},
				success : function(data) {
					console.log(data);
					var total=0;
					if (data.length > 0) {
						for (var i = 0; i < data.length; i++) {
							//对数据进行遍历，拿到hardware_Group里的hardwareList
							var list = data[i].hardware_Group.hardwareList;
							//对hardwareList进行遍历，将数据写入单元格
							if(list.length>0){
								for (var j = 0; j < list.length; j++) {
									total+=list[j].price;
									$("#tableOrder").append("<tr><td>"+list[j].module+"</td><td>"+list[j].name+"</td>"+
											"<td>"+list[j].type+"</td><td>"+list[j].unit+"</td>"+
											"<td>"+list[j].num+"</td><td>"+list[j].brand+"</td>"+
											"<td>"+list[j].price+"</td></tr>");
									
								}
							}
							
							
						}
					}
					console.log(id);
					$("#tab").append("<div id='total'>总价:"+total+"</div>"+
							"<a class='btn btn-primary' href='javascript:updateShow("+id+")' role='button'>修改订单</a>&nbsp;&nbsp;&nbsp;&nbsp;"+
							"<a class='btn btn-primary' href='user_forward.do?name=checkOrder' role='button'>返回</a>");
				}

			})

			$(".orderList").css("display", "none");
			$("#order").css("display", "block");
		}
		
		function del(id){
			if(confirm('确实要删除该内容吗?')){
				$.ajax({
					data : {
						"oId" : id
					},
					url:"user_deleteOrder.do",
					success:function(data){
						location.href="user_forward.do?name=checkOrder";
					}
				})
			}
			
		}
		function updateShow(oId){
			var storage=window.localStorage;
			storage["oId"]=oId;
			location.href="user_forward.do?name=update";
		}
	</script>
</body>
</html>